<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prediction Results | Bank Marketing Predictor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-chart-line"></i> BankPredict AI
            </a>
        </div>
    </nav>

    <div class="container mt-5 pt-5">
        <div class="row">
            <div class="col-lg-10 mx-auto">
                <!-- Result Header -->
                <div class="result-header text-center mb-5">
                    <h1 class="display-5">
                        {% if prediction == 1 %}
                        <i class="fas fa-check-circle text-success"></i> High Conversion Potential
                        {% else %}
                        <i class="fas fa-times-circle text-warning"></i> Low Conversion Potential
                        {% endif %}
                    </h1>
                    <p class="lead">Based on our AI analysis, this customer has a <strong>{{ "%.1f"|format(probability) }}%</strong> probability of subscribing.</p>
                </div>

                <!-- Prediction Visualizations -->
                <div class="row mb-5">
                    <div class="col-md-6">
                        <div class="card h-100">
                            <div class="card-body">
                                <div id="gaugeChart"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card h-100">
                            <div class="card-body">
                                <div id="barChart"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recommendation Card -->
                <div class="card recommendation-card mb-4">
                    <div class="card-header">
                        <h4><i class="fas fa-lightbulb"></i> AI Recommendations</h4>
                    </div>
                    <div class="card-body">
                        {% if prediction == 1 %}
                        <div class="alert alert-success">
                            <h5><i class="fas fa-thumbs-up"></i> Recommended Action: Prioritize Contact</h5>
                            <p>This customer shows strong interest indicators. Consider:</p>
                            <ul>
                                <li>Schedule follow-up within 24 hours</li>
                                <li>Offer personalized product recommendations</li>
                                <li>Consider special offers if applicable</li>
                            </ul>
                        </div>
                        {% else %}
                        <div class="alert alert-warning">
                            <h5><i class="fas fa-exclamation-triangle"></i> Recommended Action: Low Priority</h5>
                            <p>This customer shows low conversion potential. Consider:</p>
                            <ul>
                                <li>Focus resources on higher-potential leads</li>
                                <li>Send automated follow-up instead of personal call</li>
                                <li>Re-evaluate in next campaign cycle</li>
                            </ul>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="text-center mb-5">
                    <a href="/predict" class="btn btn-primary btn-lg me-3">
                        <i class="fas fa-redo"></i> Make Another Prediction
                    </a>
                    <a href="/" class="btn btn-outline-primary btn-lg">
                        <i class="fas fa-home"></i> Return to Home
                    </a>
                    <button class="btn btn-outline-secondary btn-lg ms-3" onclick="window.print()">
                        <i class="fas fa-print"></i> Print Report
                    </button>
                </div>

                <!-- Confidence Metrics -->
                <div class="row">
                    <div class="col-md-4">
                        <div class="metric-card text-center">
                            <div class="metric-value">{{ "%.1f"|format(probability) }}%</div>
                            <div class="metric-label">Conversion Probability</div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="metric-card text-center">
                            <div class="metric-value">{{ "%.1f"|format(confidence) }}%</div>
                            <div class="metric-label">Model Confidence</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Render Plotly charts
        var gaugeGraph = {{ graphJSON_gauge | safe }};
        var barGraph = {{ graphJSON_bar | safe }};
        
        Plotly.newPlot('gaugeChart', gaugeGraph.data, gaugeGraph.layout);
        Plotly.newPlot('barChart', barGraph.data, barGraph.layout);

        // Add animation to metrics
        document.querySelectorAll('.metric-value').forEach(el => {
            const finalValue = parseFloat(el.textContent);
            el.textContent = '0%';
            
            let current = 0;
            const increment = finalValue / 50;
            const timer = setInterval(() => {
                current += increment;
                if (current >= finalValue) {
                    clearInterval(timer);
                    current = finalValue;
                }
                el.textContent = current.toFixed(1) + '%';
            }, 20);
        });
    </script>
</body>
</html>